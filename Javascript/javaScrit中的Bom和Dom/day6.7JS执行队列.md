# JS执行队列

## 一、JS执行机制原理

解析：JS是单线程

javaScript的一个大特点就是单线程，也就是说：`同一个时间只可以做一件事`。这是因为javaScript这门语言诞生的使命所导致的【JS是为处理页面中用户的交互，以及操作DOM诞生的】。比如我们对某个DOM元素进行添加和删除操作，不能同时进行，应该先进行添加，再进行删除

## 二、单线程带来的后果？

解析：单线程就意味着，所以的任务都需要排队，前一个任务结束，才会执行后一个任务。这样所导致的问题是：如果JS执行时间过长，就会造成页面的渲染不连贯，导致页面渲染加载阻塞的感觉。

## 三、第一个问题：以下代码的执行结果是什么？

解析：

```javascript
<script>
    console.log(1);//这一串代码会先执行

    setTimeout(function() {
        console.log(3);//使用回调函数，2000毫秒之后才会执行这一个代码
    },2000);
    console.log(2);//这一串代码会在上一串回调函数执行前执行
</script>
```

## 四、如何解决JS代码按照顺序执行？

解析：这里涉及到了JS的同步和异步执行机制

为了解决这一个问题，利用多核CPU的计算能力，HTML5提出了Web Worker标准，允许JS创建多个线程，于是JS中出现了同步和异步

#### 同步：前一个任务结束后再执行下一个任务，程序的执行顺序与任务的排列顺序是一致的、同步的。比如做饭的同步做法：我们要烧水煮饭，等水开了（10分钟之后），再去切菜、炒菜

#### 异步：你在做一件事的时候，因为这一件事会花费很长的时间，在做这件事的同时，你还可以去处理其它事情。比如做法异步做法：我们在烧水的同时，利用这10分钟去切菜、炒菜

#### 二者的本质区别：这条流水线上各个流程的执行顺序不同

## 五、第二个问题：以下代码的执行顺序是什么？

 ```javaScript
 <script>
     console.log(1);//第一先执行
     setTimeout(function() {
         console.log(3);//最后执行
     },0);
     console.log(2);//第二执行
 </script>
 ```

解析：这是为什么？时间已经设置为0了，还是按照123的顺序执行的，这就涉及到了同步任务和异步任务

# 同步任务和异步任务

## 一、同步任务？

解析：同步任务都在主线程上执行，形成一个执行栈、

![image-20230220125238443](C:\Users\谭磊\AppData\Roaming\Typora\typora-user-images\image-20230220125238443.png)

解析：jS把所有的同步任务都放到执行栈里去，可以看到栈里面只有一个定时器，但是回调函数在消息队列里，这两个不属于同一个。

## 二、异步任务？

解析：JS的异步是通过回调函数来实现的，一般而言，异步任务有以下三种类型：

1.普通事件：如：click、resize等

2.资源加载：如：load、error等

3.定时器：包括setInterval、setTImeout等

#### 注意：异步任务相关回调函数添加到任务队列中（任务队列有时也称为消息队列）

## 三、JS执行机制

1.先执行栈中的同步任务

2.异步任务，也就是回调函数放入消息队列中

3.一旦执行栈中的所有同步任务执行完毕，系统就会按照次序读取消息队列中的异步任务，于是被读取的异步任务结束等待状态，进入执行栈，开始执行

![image-20230220130931769](C:\Users\谭磊\AppData\Roaming\Typora\typora-user-images\image-20230220130931769.png)

解析：在主车道里，突然有一辆车坏了，为了不影响行车，所以把坏的车辆放到应急车道里面去，不影响主车道的行车环境，大大提高了通行效率
